{"version":3,"sources":["BasemapSelector.js","hooks.js","Controls.js","experiments/Ships.js","Map.js","App.js","reportWebVitals.js","index.js"],"names":["basemaps","title","url","icon","setBasemap","viewport","mapboxApiAccessToken","debouncedViewport","value","delay","debouncedValue","setDebouncedValue","useState","useEffect","handler","setTimeout","clearTimeout","useDebounce","basemapCanvasRefs","map","basemap","useRef","justLoaded","setJustLoaded","navigate","useNavigate","Promise","all","_","i","async","img","Image","index","onload","canvas","current","ctx","getContext","test","globalAlpha","drawableWidth","width","drawableHeight","height","x","y","drawImage","requestAnimationFrame","src","longitude","latitude","zoom","Math","min","setImage","location","useLocation","Box","p","Paper","pt","pb","display","flexDirection","Button","onClick","rest","pathname","split","slice","join","toLowerCase","style","borderRadius","ref","Controls","setAddingLocations","addingLocations","experiments","setExperiments","motion","div","initial","opacity","animate","color","BasemapSelector","Layer","viewState","divider","setDivider","animationSpeed","time","setTime","animation","useCallback","t","id","window","data","setData","fetched","fetch","d","text","filter","line","parsed","JSON","parse","waypoints","zip","polyline","decode","coordinates","timestamp","cancelAnimationFrame","length","Infinity","max","forEach","list","layer","TripsLayer","getPath","getTimestamps","getColor","widthMinPixels","rounded","fadeTrail","getWidth","trailLength","currentTime","shadowEnabled","useDevicePixels","layers","MAPBOX_TOKEN","process","Map","findIndex","b","toLocaleLowerCase","setBaseMap","setViewport","innerWidth","innerHeight","mapRef","onresize","handleGeocoderViewportChange","newViewport","markers","setMarkers","console","log","position","zIndex","bottom","left","top","mapStyle","onNativeClick","ev","lngLat","concat","Date","getTime","popup","onViewportChange","nextViewport","marker","toFixed","closeButton","right","IconButton","size","m","Typography","navigator","clipboard","writeText","fontSize","translateY","transition","duration","ease","offsetLeft","offsetTop","draggable","onDragEnd","handleMarkerDragEnd","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9ea75845.chunk.js","sourcesContent":["import { Button, Paper, Box } from '@material-ui/core';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useDebounce } from \"./hooks\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\n\nexport const basemaps = [\n  { title: \"Streets\", url: \"mapbox://styles/mapbox/streets-v11\", icon: \"mapbox/streets-v11\" },\n  { title: \"Satellite\", url: \"mapbox://styles/mapbox/satellite-v9\", icon: \"mapbox/satellite-v9\" },\n  { title: \"Dark\", url: \"mapbox://styles/palikk/ckw20gafz6s7i14qe4z2qgsy9\", icon: \"palikk/ckw20gafz6s7i14qe4z2qgsy9\" },\n];\n\n// No idea what is going on here.\n// Trying to use named function breaks useRef.\n// eslint-disable-next-line\nexport default function ({ setBasemap, viewport, mapboxApiAccessToken }) {\n\n  const debouncedViewport = useDebounce(viewport, 5000);\n  const basemapCanvasRefs = basemaps.map(basemap => useRef(null));\n\n  const [justLoaded, setJustLoaded] = useState(false);\n  useEffect(() => {\n    setTimeout(() => setJustLoaded(true), 3000);\n  }, []);\n  const navigate = useNavigate();\n  useEffect(() => {\n    if (!justLoaded) return;\n\n    const setImage = async (index) => {\n      const img = new Image();\n      const basemap = basemaps[index];\n      img.onload = () => {\n        const canvas = basemapCanvasRefs[index].current;\n        const ctx = canvas.getContext(\"2d\");\n        let i = 0;\n        const test = () => {\n          i += 0.01;\n          ctx.globalAlpha = i;\n          let drawableWidth = canvas.width;\n          let drawableHeight = canvas.height;\n          let x = 0, y = 0;\n          if (img.height > img.width) {\n            drawableHeight = drawableWidth / img.width * img.height;\n            y = (canvas.height - drawableHeight) / 2;\n          } else {\n            drawableWidth = drawableHeight / img.height * img.width;\n            x = (canvas.width - drawableWidth) / 2;\n          }\n          ctx.drawImage(img, x, y, drawableWidth, drawableHeight);\n          if (i < 1) {\n            requestAnimationFrame(test);\n          }\n        };\n        requestAnimationFrame(test);\n      };\n      img.src = `https://api.mapbox.com/styles/v1/${basemap.icon}/static/${debouncedViewport.longitude},${debouncedViewport.latitude},${debouncedViewport.zoom}/${Math.min(debouncedViewport.width, 1280)}x${Math.min(debouncedViewport.height, 1280)}?access_token=${mapboxApiAccessToken}`;\n    };\n    Promise.all(basemaps.map((_, i) => {\n      return setImage(i);\n    }));\n  }, [justLoaded, debouncedViewport, basemapCanvasRefs, mapboxApiAccessToken]);\n\n  const location = useLocation();\n\n  return (\n    <Box p={1}>\n      <Paper>\n        <Box pt={0.5} pb={0.5} display=\"flex\" flexDirection=\"column\">\n          {basemaps.map((basemap, i) => (\n            <Button key={i} onClick={() => {\n              setBasemap(basemap.url);\n              const rest = location.pathname.split(\"/\").slice(2).join(\"/\");\n              navigate(`/${basemap.title.toLowerCase()}/${rest}`);\n            }}>\n              <canvas style={{\"border\": \"1px solid rgba(0, 0, 0, 0.5)\", borderRadius: 5}} ref={basemapCanvasRefs[i]} width={50} height={50} />\n            </Button>\n          ))}\n        </Box>\n      </Paper>\n    </Box>\n  );\n}\n","// Hook\nimport { useRef, useState, useEffect } from 'react';\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}\n\nexport function usePrevious(value) {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  const ref = useRef();\n\n  // Store current value in ref\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n\n  // Return previous value (happens before update in useEffect above)\n  return ref.current;\n}\n\nexport const useInterval = (callback, delay) => {\n  const savedCallback = useRef();\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    const tick = () => {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n};","import React, {useState, useEffect} from 'react';\nimport { Button, Paper, Box } from '@material-ui/core';\nimport AddLocationAltIcon from '@mui/icons-material/AddLocationAlt';\nimport BasemapSelector from './BasemapSelector';\nimport { motion } from 'framer-motion';\n\nfunction Controls({viewport, basemap, mapboxApiAccessToken, setBasemap, setAddingLocations, addingLocations, experiments, setExperiments}) {\n  const [justLoaded, setJustLoaded] = useState(false);\n  useEffect(() => {\n    setTimeout(() => setJustLoaded(true), 3000);\n  }, []);\n  return (<motion.div initial={{ opacity: 0 }} animate={{ opacity: justLoaded ? 1 : 0 }}>\n      <Box p={1} pb={0}>\n        <Paper>\n          <Box p={0.5} display=\"flex\" flexDirection=\"column\">\n            <Button onClick={() => { setAddingLocations(p => !p); }}>\n              <AddLocationAltIcon color={addingLocations ? \"success\" : \"disabled\"} />\n            </Button>\n          </Box >\n        </Paper>\n      </Box>\n      <Box p={1} pb={0}>\n        <Paper>\n          <Box p={0.5} display=\"flex\" flexDirection=\"column\">\n            <Button onClick={() => {\n              if (experiments[\"ships\"]) {\n                setExperiments({...experiments, \"ships\": false});\n              } else {\n                setExperiments({...experiments, \"ships\": true});\n              }\n            }}>\n              SHIPS\n            </Button>\n          </Box >\n        </Paper>\n      </Box>\n      <BasemapSelector\n        viewport={viewport}\n        basemap={basemap}\n        mapboxApiAccessToken={mapboxApiAccessToken}\n        setBasemap={setBasemap} />\n  </motion.div >\n  );\n}\n\nexport default Controls;","import { TripsLayer } from '@deck.gl/geo-layers';\nimport DeckGL from '@deck.gl/react';\nimport { useEffect, useState, useCallback } from 'react';\nimport _ from \"lodash\";\nimport polyline from \"@mapbox/polyline\";\n\nexport default function Layer({ viewState }) {\n  const [divider, setDivider] = useState(3600 * 1000 * 24); // default to 24h\n  const animationSpeed = 3600 * 1000 * 24 / 1500; // 24h has 1500 steps, total ~25s\n  const [time, setTime] = useState(0);\n  const [animation] = useState({});\n\n  const animate = useCallback(() => {\n    setTime(t => (t + animationSpeed) % divider);\n    animation.id = window.requestAnimationFrame(animate);\n  }, [animation, animationSpeed, divider]);\n\n  const [data, setData] = useState([]);\n\n  useEffect(() => {\n    (async () => {\n      const fetched = await fetch(\"/ships\");\n      const lines = (await fetched.text()).split(\"\\n\");\n      const d = lines.filter(line => line).map((line) => {\n        const parsed = JSON.parse(line);\n        return {waypoints: \n          _.zip(polyline.decode(parsed[0]), parsed[1]).map(line => ({\n            coordinates: line[0],\n            timestamp: line[1]\n          })) \n        };\n      });\n      setData(d);\n    })();\n  }, []);\n\n  useEffect(\n    () => {\n      animation.id = window.requestAnimationFrame(animate);\n      return () => window.cancelAnimationFrame(animation.id);\n    },\n    [animation, animate]\n  );\n\n  useEffect(() => {\n    if (data.length === 0) return;\n    // get maximum timestamp from data\n    let min = Infinity;\n    let max = 0;\n    data.forEach(d => d.waypoints.forEach(list => {\n      if (list.timestamp > max) {\n        max = list.timestamp;\n      }\n      if (list.timestamp < min) {\n        min = list.timestamp;\n      }\n    }));\n    // get minimum timestamp from data\n    setDivider(max - min);\n  }, [data]);\n  const layer = new TripsLayer({\n    id: 'trips-layer',\n    data,\n    getPath: d => d.waypoints.map(p => p.coordinates),\n    // deduct start timestamp from each data point to avoid overflow\n    getTimestamps: d => d.waypoints.map(p => p.timestamp),\n    getColor: [92, 181, 249],\n    opacity: 0.2,\n    widthMinPixels: 5,\n    rounded: true,\n    fadeTrail: true,\n    getWidth: d => 5,\n    trailLength: animationSpeed * 150 * 5,\n    currentTime: time,\n\n    shadowEnabled: false\n  });\n\n  return <DeckGL useDevicePixels={false} viewState={viewState} layers={[layer]} />;\n};","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport ReactMapGL, { Marker, Popup } from 'react-map-gl';\nimport Geocoder from \"react-map-gl-geocoder\";\nimport 'react-map-gl-geocoder/dist/mapbox-gl-geocoder.css';\nimport RoomIcon from '@mui/icons-material/Room';\nimport { basemaps } from \"./BasemapSelector\";\nimport { motion } from 'framer-motion';\nimport Controls from './Controls';\nimport { Box, IconButton, Typography } from '@material-ui/core';\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\nimport CloseIcon from '@mui/icons-material/Close';\nimport Ships from \"./experiments/Ships\";\nimport { useLocation } from \"react-router-dom\";\n\nconst MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN;\nfunction Map() {\n  const location = useLocation();\n  useEffect(() => {\n    const index = basemaps.findIndex(b => b.title.toLocaleLowerCase() === location.pathname.split(\"/\")[1]);\n    if (index === -1) {\n      setBaseMap(basemaps[1].url);\n    } else {\n      setBaseMap(basemaps[index].url);\n    }\n  }, [location.pathname]);\n\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    latitude: 65.41,\n    longitude: 25.88,\n    zoom: 4.3\n  });\n\n  const [basemap, setBaseMap] = useState(basemaps[1].url);\n  const mapRef = useRef();\n  window.onresize = () => {\n    setViewport({\n      ...viewport,\n      width: window.innerWidth,\n      height: window.innerHeight\n    });\n  };\n\n  const handleGeocoderViewportChange = useCallback(\n    (newViewport) => {\n      setViewport(newViewport);\n    },\n    []\n  );\n\n  const [markers, setMarkers] = useState([]);\n  const [addingLocations, setAddingLocations] = useState(false);\n\n  const handleOnClick = (ev) => {\n    if (addingLocations) {\n      const coordinates = ev.lngLat;\n      setMarkers(markers.concat({ id: new Date().getTime(), latitude: coordinates[1], longitude: coordinates[0], popup: false }));\n    }\n  };\n\n  const handleMarkerDragEnd = (id, ev) => {\n    setMarkers(markers.map(m => (m.id === id ? { ...m, latitude: ev.lngLat[1], longitude: ev.lngLat[0] } : m)));\n  };\n\n  const [experiments, setExperiments] = useState({});\n\n  useEffect(() => {\n    console.log(markers);\n  }, [markers]);\n  const handleMarkerClick = (id, ev) => {\n    setMarkers(markers.map(m => (m.id === id ? { ...m, popup: true } : m)));\n  };\n\n  return (<div>\n    <div style={{ position: \"absolute\", zIndex: 2, bottom: 30, left: 20 }}>\n      <Controls\n        viewport={viewport}\n        basemap={basemap}\n        mapboxApiAccessToken={MAPBOX_TOKEN}\n        setBasemap={setBaseMap}\n        setAddingLocations={setAddingLocations}\n        addingLocations={addingLocations}\n        experiments={experiments}\n        setExperiments={setExperiments}\n      />\n    </div>\n    <div style={{ position: 'absolute', top: 0, left: 0 }}>\n      <ReactMapGL\n        {...viewport}\n        ref={mapRef}\n        mapStyle={basemap}\n        onNativeClick={handleOnClick}\n        mapboxApiAccessToken={MAPBOX_TOKEN}\n        onViewportChange={nextViewport => setViewport(nextViewport)}\n      >\n        {experiments[\"ships\"] && <Ships viewState={viewport} /> }\n        {markers.map(marker => {\n          const text = `lat: ${marker.latitude.toFixed(5)}, lng: ${marker.longitude.toFixed(5)}`;\n          return (<>\n            {marker.popup &&\n              <Popup\n                key={marker.id}\n                latitude={marker.latitude}\n                longitude={marker.longitude}\n                style={{ zIndex: 100 }}\n                closeButton={false}\n              >\n                <Box display=\"flex\" flexDirection=\"column\">\n                  <Box position=\"absolute\" top=\"5px\" right=\"5px\">\n                    <IconButton size=\"small\" onClick={() => { setMarkers(markers.map(m => (m.id === marker.id ? { ...m, popup: false } : m))); }} >\n                      <CloseIcon />\n                    </IconButton>\n                  </Box>\n                  <Box><br /></Box>\n                  <Typography>\n                    {text}\n                    <IconButton size=\"small\" onClick={() => navigator.clipboard.writeText(text)}><ContentCopyIcon fontSize=\"16px\" /></IconButton>\n                  </Typography>\n                </Box>\n              </Popup>\n            }\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: [0, 0.3, 0.5, 1], translateY: [-100, 0] }}\n              transition={{ duration: 0.3, ease: 'easeOut' }}\n            >\n              <Marker\n                offsetLeft={-12}\n                offsetTop={-24}\n                draggable={true}\n                key={marker.id}\n                latitude={marker.latitude}\n                longitude={marker.longitude}\n                onDragEnd={(ev) => { handleMarkerDragEnd(marker.id, ev); }}\n                onClick={(ev) => { handleMarkerClick(marker.id, ev); }}\n              >\n                <RoomIcon color={\"info\"} />\n              </Marker>\n            </motion.div>\n          </>\n          );\n        })}\n          <Geocoder\n            mapRef={mapRef}\n            onViewportChange={handleGeocoderViewportChange}\n            mapboxApiAccessToken={MAPBOX_TOKEN}\n            position=\"top-right\"\n          />\n      </ReactMapGL>\n    </div>\n  </div>\n  );\n}\nexport default Map;\n","import './App.css';\nimport Map from './Map';\nimport React from \"react\";\nimport { HashRouter } from \"react-router-dom\";\n\nfunction App() {\n  return (\n    <HashRouter>\n      <Map />\n    </HashRouter>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}