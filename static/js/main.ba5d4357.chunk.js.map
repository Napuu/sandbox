{"version":3,"sources":["BasemapSelector.js","hooks.js","Controls.js","experiments/Ships.js","Map.js","App.js","reportWebVitals.js","index.js"],"names":["basemaps","title","url","icon","setBasemap","viewport","mapboxApiAccessToken","debouncedViewport","value","delay","debouncedValue","setDebouncedValue","useState","useEffect","handler","setTimeout","clearTimeout","useDebounce","basemapCanvasRefs","map","basemap","useRef","justLoaded","setJustLoaded","navigate","useNavigate","Promise","all","_","i","async","img","Image","index","onload","canvas","current","ctx","getContext","test","globalAlpha","drawableWidth","width","drawableHeight","height","x","y","drawImage","requestAnimationFrame","src","longitude","latitude","zoom","Math","min","setImage","Box","p","Paper","pt","pb","display","flexDirection","Button","onClick","toLowerCase","style","borderRadius","ref","Controls","setAddingLocations","addingLocations","motion","div","initial","opacity","animate","color","BasemapSelector","Layer","data","viewState","animationSpeed","time","setTime","animation","useCallback","t","id","window","cancelAnimationFrame","length","layer","TripsLayer","getPath","d","waypoints","coordinates","getTimestamps","timestamp","getColor","widthMinPixels","rounded","fadeTrail","getWidth","trailLength","currentTime","shadowEnabled","useDevicePixels","layers","MAPBOX_TOKEN","process","Map","location","useLocation","findIndex","b","toLocaleLowerCase","pathname","split","setBaseMap","setViewport","innerWidth","innerHeight","mapRef","onresize","handleGeocoderViewportChange","newViewport","markers","setMarkers","console","log","setData","fetched","fetch","text","filter","line","parsed","JSON","parse","zip","polyline","decode","position","zIndex","bottom","top","left","mapStyle","onNativeClick","ev","lngLat","concat","Date","getTime","popup","onViewportChange","nextViewport","path","element","marker","toFixed","closeButton","right","IconButton","size","m","Typography","navigator","clipboard","writeText","fontSize","translateY","transition","duration","ease","offsetLeft","offsetTop","draggable","onDragEnd","handleMarkerDragEnd","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"4UAKO,MAAMA,EAAW,CACtB,CAAEC,MAAO,UAAWC,IAAK,qCAAsCC,KAAM,sBACrE,CAAEF,MAAO,YAAaC,IAAK,sCAAuCC,KAAM,uBACxE,CAAEF,MAAO,OAAQC,IAAK,mDAAoDC,KAAM,qCAMnE,kBAA2D,IAAjD,WAAEC,EAAF,SAAcC,EAAd,qBAAwBC,GAAwB,EAEvE,MAAMC,ECdD,SAAqBC,EAAOC,GAEjC,MAAOC,EAAgBC,GAAqBC,mBAASJ,GAmBrD,OAjBAK,qBACE,KAEE,MAAMC,EAAUC,YAAW,KACzBJ,EAAkBH,KACjBC,GAKH,MAAO,KACLO,aAAaF,MAGjB,CAACN,EAAOC,IAGHC,EDPmBO,CAAYZ,EAAU,KAC1Ca,EAAoBlB,EAASmB,KAAIC,GAAWC,iBAAO,SAElDC,EAAYC,GAAiBX,oBAAS,GAC7CC,qBAAU,KACRE,YAAW,IAAMQ,GAAc,IAAO,OACrC,IACH,MAAMC,EAAWC,cAsCjB,OArCAZ,qBAAU,KACR,IAAKS,EAAY,OA+BjBI,QAAQC,IAAI3B,EAASmB,KAAI,CAACS,EAAGC,IA7BZC,WACf,MAAMC,EAAM,IAAIC,MACVZ,EAAUpB,EAASiC,GACzBF,EAAIG,OAAS,KACX,MAAMC,EAASjB,EAAkBe,GAAOG,QAClCC,EAAMF,EAAOG,WAAW,MAC9B,IAAIT,EAAI,EACR,MAAMU,EAAO,KACXV,GAAK,IACLQ,EAAIG,YAAcX,EAClB,IAAIY,EAAgBN,EAAOO,MACvBC,EAAiBR,EAAOS,OACxBC,EAAI,EAAGC,EAAI,EACXf,EAAIa,OAASb,EAAIW,OACnBC,EAAiBF,EAAgBV,EAAIW,MAAQX,EAAIa,OACjDE,GAAKX,EAAOS,OAASD,GAAkB,IAEvCF,EAAgBE,EAAiBZ,EAAIa,OAASb,EAAIW,MAClDG,GAAKV,EAAOO,MAAQD,GAAiB,GAEvCJ,EAAIU,UAAUhB,EAAKc,EAAGC,EAAGL,EAAeE,GACpCd,EAAI,GACNmB,sBAAsBT,IAG1BS,sBAAsBT,IAExBR,EAAIkB,IAAO,oCAAmC7B,EAAQjB,eAAeI,EAAkB2C,aAAa3C,EAAkB4C,YAAY5C,EAAkB6C,QAAQC,KAAKC,IAAI/C,EAAkBmC,MAAO,SAASW,KAAKC,IAAI/C,EAAkBqC,OAAQ,sBAAsBtC,KAGzPiD,CAAS1B,QAEjB,CAACP,EAAYf,EAAmBW,EAAmBZ,IAGpD,cAACkD,EAAA,EAAD,CAAKC,EAAG,EAAR,SACE,cAACC,EAAA,EAAD,UACE,cAACF,EAAA,EAAD,CAAKG,GAAI,GAAKC,GAAI,GAAKC,QAAQ,OAAOC,cAAc,SAApD,SACG9D,EAASmB,KAAI,CAACC,EAASS,IACtB,cAACkC,EAAA,EAAD,CAAgBC,QAAS,KACvB5D,EAAWgB,EAAQlB,KACnBsB,EAAU,IAAGJ,EAAQnB,MAAMgE,kBAF7B,SAIE,wBAAQC,MAAO,CAAC,OAAU,+BAAgCC,aAAc,GAAIC,IAAKlD,EAAkBW,GAAIa,MAAO,GAAIE,OAAQ,MAJ/Gf,Y,2BEpCVwC,MAxBf,YAA+G,IAA7F,SAAChE,EAAD,QAAWe,EAAX,qBAAoBd,EAApB,WAA0CF,EAA1C,mBAAsDkE,EAAtD,gBAA0EC,GAAkB,EAC5G,MAAOjD,EAAYC,GAAiBX,oBAAS,GAI7C,OAHAC,qBAAU,KACRE,YAAW,IAAMQ,GAAc,IAAO,OACrC,IACK,eAACiD,EAAA,EAAOC,IAAR,CAAYC,QAAS,CAAEC,QAAS,GAAKC,QAAS,CAAED,QAASrD,EAAa,EAAI,EAAI,GAA9E,UACJ,cAACkC,EAAA,EAAD,CAAKC,EAAG,EAAGG,GAAI,EAAf,SACE,cAACF,EAAA,EAAD,UACE,cAACF,EAAA,EAAD,CAAKC,EAAG,GAAKI,QAAQ,OAAOC,cAAc,SAA1C,SACE,cAACC,EAAA,EAAD,CAAQC,QAAS,KAAQM,GAAmBb,IAAMA,KAAlD,SACE,cAAC,IAAD,CAAoBoB,MAAON,EAAkB,UAAY,qBAKjE,cAACO,EAAD,CACEzE,SAAUA,EACVe,QAASA,EACTd,qBAAsBA,EACtBF,WAAYA,Q,wECtBL,SAAS2E,EAAT,GAAqC,IAAtB,KAAEC,EAAF,UAAQC,GAAa,EAejD,MAAMC,EAAiB,OAChBC,EAAMC,GAAWxE,mBAAS,IAC1ByE,GAAazE,mBAAS,IAEvBgE,EAAUU,uBAAY,KAC1BF,GAAQG,IAAMA,EAAIL,GAAkB,QACpCG,EAAUG,GAAKC,OAAOzC,sBAAsB4B,KAC3C,CAACS,EAAWH,IAEfrE,qBACE,KACEwE,EAAUG,GAAKC,OAAOzC,sBAAsB4B,GACrC,IAAMa,OAAOC,qBAAqBL,EAAUG,MAErD,CAACH,EAAWT,IAGd/D,qBAAU,KACJmE,EAAKW,SAgBR,CAACX,IACJ,MAAMY,EAAQ,IAAIC,IAAW,CAC3BL,GAAI,cACJR,OACAc,QAASC,GAAKA,EAAEC,UAAU7E,KAAIsC,GAAKA,EAAEwC,cAErCC,cAAeH,GAAKA,EAAEC,UAAU7E,KAAIsC,GAAKA,EAAE0C,YAC3CC,SAAU,CAAC,GAAI,IAAK,KACpBzB,QAAS,GACT0B,eAAgB,EAChBC,SAAS,EACTC,WAAW,EACXC,SAAUT,GAAK,EACfU,YAAavB,MACbwB,YAAavB,EAEbwB,eAAe,IAGjB,OAAO,cAAC,IAAD,CAAQC,iBAAiB,EAAM3B,UAAWA,EAAW4B,OAAQ,CAACjB,K,wCCnDvE,MAAMkB,EAAeC,2FAsKNC,MArKf,WACE,MAAMC,EAAWC,cACjBrG,qBAAU,KACR,MAAMoB,EAAQjC,EAASmH,WAAUC,GAAKA,EAAEnH,MAAMoH,sBAAwBJ,EAASK,SAASC,MAAM,KAAK,KAEjGC,GADa,IAAXvF,EACSjC,EAAS,GAAGE,IAEZF,EAASiC,GAAO/B,OAE5B,CAAC+G,EAASK,WAEb,MAAOjH,EAAUoH,GAAe7G,mBAAS,CACvC8B,MAAO+C,OAAOiC,WACd9E,OAAQ6C,OAAOkC,YACfxE,SAAU,MACVD,UAAW,MACXE,KAAM,OAGDhC,EAASoG,GAAc5G,mBAASZ,EAAS,GAAGE,KAC7C0H,EAASvG,mBACfoE,OAAOoC,SAAW,KAChBJ,EAAY,IACPpH,EACHqC,MAAO+C,OAAOiC,WACd9E,OAAQ6C,OAAOkC,eAInB,MAAMG,EAA+BxC,uBAClCyC,IACCN,EAAYM,KAEd,KAGKC,EAASC,GAAcrH,mBAAS,KAChC2D,EAAiBD,GAAsB1D,oBAAS,GAavDC,qBAAU,KACRqH,QAAQC,IAAIH,KACX,CAACA,IAKJnH,qBAAU,KACRuH,EAAQ,CACJ,CACEpC,UAAW,CACX,CAACC,YAAa,CAAC,GAAI,IAAKE,UAAW,eACnC,CAACF,YAAa,CAAC,GAAG,IAAKE,UAAW,eAClC,CAACF,YAAa,CAAC,GAAI,IAAKE,UAAW,mBAIzC,WACE,MAAMkC,QAAgBC,MAAM,UAEtBvC,SADesC,EAAQE,QAAQhB,MAAM,MAC3BiB,QAAOC,GAAQA,IAAMtH,KAAKsH,IACxC,MAAMC,EAASC,KAAKC,MAAMH,GAC1B,MAAO,CAACzC,UACNpE,IAAEiH,IAAIC,IAASC,OAAOL,EAAO,IAAKA,EAAO,IAAIvH,KAAIsH,IAAI,CACnDxC,YAAawC,EAAK,GAClBtC,UAAWsC,EAAK,WAItBL,EAAQrC,IAZV,KAcC,IAEH,MAAOf,EAAMoD,GAAWxH,mBAAS,IAEjC,OAAQ,gCACN,qBAAKsD,MAAO,CAAE8E,SAAU,WAAYC,OAAQ,EAAGC,OAAQ,IAAvD,SACE,cAAC,EAAD,CACE7I,SAAUA,EACVe,QAASA,EACTd,qBAAsBwG,EACtB1G,WAAYoH,EACZlD,mBAAoBA,EACpBC,gBAAiBA,MAGrB,qBAAKL,MAAO,CAAE8E,SAAU,WAAYG,IAAK,EAAGC,KAAM,GAAlD,SACE,eAAC,IAAD,IACM/I,EACJ+D,IAAKwD,EACLyB,SAAUjI,EACVkI,cA9DiBC,IACrB,GAAIhF,EAAiB,CACnB,MAAM0B,EAAcsD,EAAGC,OACvBvB,EAAWD,EAAQyB,OAAO,CAAEjE,IAAI,IAAIkE,MAAOC,UAAWxG,SAAU8C,EAAY,GAAI/C,UAAW+C,EAAY,GAAI2D,OAAO,OA4DhHtJ,qBAAsBwG,EACtB+C,iBAAkBC,GAAgBrC,EAAYqC,GANhD,UAQE,cAAC,IAAD,UACA,cAAC,IAAD,CAAOC,KAAK,kBAAkBC,QAAS,cAAC,EAAD,CAAOhF,KAAMA,EAAMC,UAAW5E,QAEpE2H,EAAQ7G,KAAI8I,IACX,MAAM1B,EAAQ,QAAO0B,EAAO9G,SAAS+G,QAAQ,YAAYD,EAAO/G,UAAUgH,QAAQ,KAClF,OAAQ,qCACLD,EAAOL,OACN,cAAC,IAAD,CAEEzG,SAAU8G,EAAO9G,SACjBD,UAAW+G,EAAO/G,UAClBgB,MAAO,CAAE+E,OAAQ,KACjBkB,aAAa,EALf,SAOE,eAAC3G,EAAA,EAAD,CAAKK,QAAQ,OAAOC,cAAc,SAAlC,UACE,cAACN,EAAA,EAAD,CAAKwF,SAAS,WAAWG,IAAI,MAAMiB,MAAM,MAAzC,SACE,cAACC,EAAA,EAAD,CAAYC,KAAK,QAAQtG,QAAS,KAAQiE,EAAWD,EAAQ7G,KAAIoJ,GAAMA,EAAE/E,KAAOyE,EAAOzE,GAAK,IAAK+E,EAAGX,OAAO,GAAUW,MAArH,SACE,cAAC,IAAD,QAGJ,cAAC/G,EAAA,EAAD,UAAK,yBACL,eAACgH,EAAA,EAAD,WACGjC,EACD,cAAC8B,EAAA,EAAD,CAAYC,KAAK,QAAQtG,QAAS,IAAMyG,UAAUC,UAAUC,UAAUpC,GAAtE,SAA6E,cAAC,IAAD,CAAiBqC,SAAS,kBAftGX,EAAOzE,IAoBhB,cAAChB,EAAA,EAAOC,IAAR,CACEC,QAAS,CAAEC,QAAS,GACpBC,QAAS,CAAED,QAAS,CAAC,EAAG,GAAK,GAAK,GAAIkG,WAAY,EAAE,IAAK,IACzDC,WAAY,CAAEC,SAAU,GAAKC,KAAM,WAHrC,SAKE,cAAC,IAAD,CACEC,YAAa,GACbC,WAAY,GACZC,WAAW,EAEXhI,SAAU8G,EAAO9G,SACjBD,UAAW+G,EAAO/G,UAClBkI,UAAY7B,IAnGE,EAAC/D,EAAI+D,KAC/BtB,EAAWD,EAAQ7G,KAAIoJ,GAAMA,EAAE/E,KAAOA,EAAK,IAAK+E,EAAGpH,SAAUoG,EAAGC,OAAO,GAAItG,UAAWqG,EAAGC,OAAO,IAAOe,MAkGtEc,CAAoBpB,EAAOzE,GAAI+D,IACpDvF,QAAUuF,IA7FE,IAAC/D,IA6FwByE,EAAOzE,GA5FxDyC,EAAWD,EAAQ7G,KAAIoJ,GAAMA,EAAE/E,KAAOA,EAAK,IAAK+E,EAAGX,OAAO,GAASW,MAoFzD,SAUE,cAAC,IAAD,CAAU1F,MAAO,UANZoF,EAAOzE,YAYlB,cAAC,IAAD,CACEoC,OAAQA,EACRiC,iBAAkB/B,EAClBxH,qBAAsBwG,EACtBkC,SAAS,uB,SCvKNsC,MARf,WACE,OACE,cAAC,IAAD,UACE,cAAC,EAAD,OCKSC,MAZSC,IAClBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAK,IAAkD,IAAjD,OAAEC,EAAF,OAAUC,EAAV,OAAkBC,EAAlB,OAA0BC,EAA1B,QAAkCC,GAAc,EACzEJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCDdQ,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,SAM1Bb,M","file":"static/js/main.ba5d4357.chunk.js","sourcesContent":["import { Button, Paper, Box } from '@material-ui/core';\nimport { useEffect, useRef, useState } from 'react';\nimport { useDebounce } from \"./hooks\";\nimport { useNavigate } from \"react-router-dom\";\n\nexport const basemaps = [\n  { title: \"Streets\", url: \"mapbox://styles/mapbox/streets-v11\", icon: \"mapbox/streets-v11\" },\n  { title: \"Satellite\", url: \"mapbox://styles/mapbox/satellite-v9\", icon: \"mapbox/satellite-v9\" },\n  { title: \"Dark\", url: \"mapbox://styles/palikk/ckw20gafz6s7i14qe4z2qgsy9\", icon: \"palikk/ckw20gafz6s7i14qe4z2qgsy9\" },\n];\n\n// No idea what is going on here.\n// Trying to use named function breaks useRef.\n// eslint-disable-next-line\nexport default function ({ setBasemap, viewport, mapboxApiAccessToken }) {\n\n  const debouncedViewport = useDebounce(viewport, 1000);\n  const basemapCanvasRefs = basemaps.map(basemap => useRef(null));\n\n  const [justLoaded, setJustLoaded] = useState(false);\n  useEffect(() => {\n    setTimeout(() => setJustLoaded(true), 3000);\n  }, []);\n  const navigate = useNavigate();\n  useEffect(() => {\n    if (!justLoaded) return;\n\n    const setImage = async (index) => {\n      const img = new Image();\n      const basemap = basemaps[index];\n      img.onload = () => {\n        const canvas = basemapCanvasRefs[index].current;\n        const ctx = canvas.getContext(\"2d\");\n        let i = 0;\n        const test = () => {\n          i += 0.01;\n          ctx.globalAlpha = i;\n          let drawableWidth = canvas.width;\n          let drawableHeight = canvas.height;\n          let x = 0, y = 0;\n          if (img.height > img.width) {\n            drawableHeight = drawableWidth / img.width * img.height;\n            y = (canvas.height - drawableHeight) / 2;\n          } else {\n            drawableWidth = drawableHeight / img.height * img.width;\n            x = (canvas.width - drawableWidth) / 2;\n          }\n          ctx.drawImage(img, x, y, drawableWidth, drawableHeight);\n          if (i < 1) {\n            requestAnimationFrame(test);\n          }\n        };\n        requestAnimationFrame(test);\n      };\n      img.src = `https://api.mapbox.com/styles/v1/${basemap.icon}/static/${debouncedViewport.longitude},${debouncedViewport.latitude},${debouncedViewport.zoom}/${Math.min(debouncedViewport.width, 1280)}x${Math.min(debouncedViewport.height, 1280)}?access_token=${mapboxApiAccessToken}`;\n    };\n    Promise.all(basemaps.map((_, i) => {\n      return setImage(i);\n    }));\n  }, [justLoaded, debouncedViewport, basemapCanvasRefs, mapboxApiAccessToken]);\n\n  return (\n    <Box p={1}>\n      <Paper>\n        <Box pt={0.5} pb={0.5} display=\"flex\" flexDirection=\"column\">\n          {basemaps.map((basemap, i) => (\n            <Button key={i} onClick={() => {\n              setBasemap(basemap.url);\n              navigate(`/${basemap.title.toLowerCase()}`);\n            }}>\n              <canvas style={{\"border\": \"1px solid rgba(0, 0, 0, 0.5)\", borderRadius: 5}} ref={basemapCanvasRefs[i]} width={50} height={50} />\n            </Button>\n          ))}\n        </Box>\n      </Paper>\n    </Box>\n  );\n}\n","// Hook\nimport { useRef, useState, useEffect } from 'react';\nexport function useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n\n  return debouncedValue;\n}\n\nexport function usePrevious(value) {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  const ref = useRef();\n\n  // Store current value in ref\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n\n  // Return previous value (happens before update in useEffect above)\n  return ref.current;\n}\n\nexport const useInterval = (callback, delay) => {\n  const savedCallback = useRef();\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    const tick = () => {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n};","import React, {useState, useEffect} from 'react';\nimport { Button, Paper, Box } from '@material-ui/core';\nimport AddLocationAltIcon from '@mui/icons-material/AddLocationAlt';\nimport BasemapSelector from './BasemapSelector';\nimport { motion } from 'framer-motion';\n\nfunction Controls({viewport, basemap, mapboxApiAccessToken, setBasemap, setAddingLocations, addingLocations}) {\n  const [justLoaded, setJustLoaded] = useState(false);\n  useEffect(() => {\n    setTimeout(() => setJustLoaded(true), 3000);\n  }, []);\n  return (<motion.div initial={{ opacity: 0 }} animate={{ opacity: justLoaded > 0 ? 1 : 0 }}>\n      <Box p={1} pb={0}>\n        <Paper>\n          <Box p={0.5} display=\"flex\" flexDirection=\"column\">\n            <Button onClick={() => { setAddingLocations(p => !p); }}>\n              <AddLocationAltIcon color={addingLocations ? \"success\" : \"disabled\"} />\n            </Button>\n          </Box >\n        </Paper>\n      </Box>\n      <BasemapSelector\n        viewport={viewport}\n        basemap={basemap}\n        mapboxApiAccessToken={mapboxApiAccessToken}\n        setBasemap={setBasemap} />\n  </motion.div >\n  );\n}\n\nexport default Controls;","import { TripsLayer } from '@deck.gl/geo-layers';\nimport DeckGL from '@deck.gl/react';\nimport { useEffect, useState, useCallback } from 'react';\nexport default function Layer({ data, viewState }) {\n  /**\n   * Data format:\n   * [\n   *   {\n   *     waypoints: [\n   *      {coordinates: [-122.3907988, 37.7664413], timestamp: 1554772579000}\n   *      {coordinates: [-122.3908298,37.7667706], timestamp: 1554772579010}\n   *       ...,\n   *      {coordinates: [-122.4485672, 37.8040182], timestamp: 1554772580200}\n   *     ]\n   *   }\n   * ]\n   */\n  // const te\n  const animationSpeed = 86400000 / 1500;\n  const [time, setTime] = useState(0);\n  const [animation] = useState({});\n\n  const animate = useCallback(() => {\n    setTime(t => (t + animationSpeed) % 86400000);\n    animation.id = window.requestAnimationFrame(animate);\n  }, [animation, animationSpeed]);\n\n  useEffect(\n    () => {\n      animation.id = window.requestAnimationFrame(animate);\n      return () => window.cancelAnimationFrame(animation.id);\n    },\n    [animation, animate]\n  );\n\n  useEffect(() => {\n    if (data.length === 0) return;\n    // get maximum timestamp from data\n    /*\n    let min = Infinity;\n    let max = 0;\n    data[0].waypoints.forEach(list => {\n      if (list.timestamp > max) {\n        max = list.timestamp;\n      }\n      if (list.timestamp < min) {\n        min = list.timestamp;\n      }\n    });\n    // get minimum timestamp from data\n    console.log(min, max, max - min);\n    */\n  }, [data]);\n  const layer = new TripsLayer({\n    id: 'trips-layer',\n    data,\n    getPath: d => d.waypoints.map(p => p.coordinates),\n    // deduct start timestamp from each data point to avoid overflow\n    getTimestamps: d => d.waypoints.map(p => p.timestamp),\n    getColor: [92, 181, 249],\n    opacity: 0.2,\n    widthMinPixels: 5,\n    rounded: true,\n    fadeTrail: true,\n    getWidth: d => 5,\n    trailLength: animationSpeed * 150 * 5,\n    currentTime: time,\n\n    shadowEnabled: false\n  });\n\n  return <DeckGL useDevicePixels={true} viewState={viewState} layers={[layer]} />;\n};","import { useCallback, useEffect, useRef, useState } from 'react';\nimport ReactMapGL, { Marker, Popup } from 'react-map-gl';\nimport Geocoder from \"react-map-gl-geocoder\";\nimport 'react-map-gl-geocoder/dist/mapbox-gl-geocoder.css';\nimport RoomIcon from '@mui/icons-material/Room';\nimport { basemaps } from \"./BasemapSelector\";\nimport { motion } from 'framer-motion';\nimport Controls from './Controls';\nimport { Box, IconButton, Typography } from '@material-ui/core';\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\nimport CloseIcon from '@mui/icons-material/Close';\nimport Ships from \"./experiments/Ships\";\nimport polyline from \"@mapbox/polyline\";\nimport _ from \"lodash\";\nimport {\n  Routes,\n  Route,\n  useLocation,\n} from \"react-router-dom\";\n\nconst MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN;\nfunction Map() {\n  const location = useLocation();\n  useEffect(() => {\n    const index = basemaps.findIndex(b => b.title.toLocaleLowerCase() === location.pathname.split(\"/\")[1]);\n    if (index === -1) {\n      setBaseMap(basemaps[1].url);\n    } else {\n      setBaseMap(basemaps[index].url);\n    }\n  }, [location.pathname]);\n\n  const [viewport, setViewport] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    latitude: 65.41,\n    longitude: 25.88,\n    zoom: 4.3\n  });\n\n  const [basemap, setBaseMap] = useState(basemaps[1].url);\n  const mapRef = useRef();\n  window.onresize = () => {\n    setViewport({\n      ...viewport,\n      width: window.innerWidth,\n      height: window.innerHeight\n    });\n  };\n\n  const handleGeocoderViewportChange = useCallback(\n    (newViewport) => {\n      setViewport(newViewport);\n    },\n    []\n  );\n\n  const [markers, setMarkers] = useState([]);\n  const [addingLocations, setAddingLocations] = useState(false);\n\n  const handleOnClick = (ev) => {\n    if (addingLocations) {\n      const coordinates = ev.lngLat;\n      setMarkers(markers.concat({ id: new Date().getTime(), latitude: coordinates[1], longitude: coordinates[0], popup: false }));\n    }\n  };\n\n  const handleMarkerDragEnd = (id, ev) => {\n    setMarkers(markers.map(m => (m.id === id ? { ...m, latitude: ev.lngLat[1], longitude: ev.lngLat[0] } : m)));\n  };\n\n  useEffect(() => {\n    console.log(markers);\n  }, [markers]);\n  const handleMarkerClick = (id, ev) => {\n    setMarkers(markers.map(m => (m.id === id ? { ...m, popup: true } : m)));\n  };\n\n  useEffect(() => {\n    setData([\n        {\n          waypoints: [\n          {coordinates: [24, 61], timestamp: 1636840097955 },\n          {coordinates: [25,62], timestamp: 1636840097955 },\n          {coordinates: [25, 63], timestamp: 1636840097975 }\n          ]\n        }\n    ]);\n    (async () => {\n      const fetched = await fetch(\"/ships\");\n      const lines = (await fetched.text()).split(\"\\n\");\n      const d = lines.filter(line => line).map((line) => {\n        const parsed = JSON.parse(line);\n        return {waypoints: \n          _.zip(polyline.decode(parsed[0]), parsed[1]).map(line => ({\n            coordinates: line[0],\n            timestamp: line[1]\n          })) \n        };\n      });\n      setData(d);\n    })();\n  }, []);\n\n  const [data, setData] = useState([]);\n\n  return (<div>\n    <div style={{ position: \"absolute\", zIndex: 2, bottom: 30 }}>\n      <Controls\n        viewport={viewport}\n        basemap={basemap}\n        mapboxApiAccessToken={MAPBOX_TOKEN}\n        setBasemap={setBaseMap}\n        setAddingLocations={setAddingLocations}\n        addingLocations={addingLocations}\n      />\n    </div>\n    <div style={{ position: 'absolute', top: 0, left: 0 }}>\n      <ReactMapGL\n        {...viewport}\n        ref={mapRef}\n        mapStyle={basemap}\n        onNativeClick={handleOnClick}\n        mapboxApiAccessToken={MAPBOX_TOKEN}\n        onViewportChange={nextViewport => setViewport(nextViewport)}\n      >\n        <Routes>\n        <Route path=\"/:basemap/ships\" element={<Ships data={data} viewState={viewport} />} />\n        </Routes>\n        {markers.map(marker => {\n          const text = `lat: ${marker.latitude.toFixed(5)}, lng: ${marker.longitude.toFixed(5)}`;\n          return (<>\n            {marker.popup &&\n              <Popup\n                key={marker.id}\n                latitude={marker.latitude}\n                longitude={marker.longitude}\n                style={{ zIndex: 100 }}\n                closeButton={false}\n              >\n                <Box display=\"flex\" flexDirection=\"column\">\n                  <Box position=\"absolute\" top=\"5px\" right=\"5px\">\n                    <IconButton size=\"small\" onClick={() => { setMarkers(markers.map(m => (m.id === marker.id ? { ...m, popup: false } : m))); }} >\n                      <CloseIcon />\n                    </IconButton>\n                  </Box>\n                  <Box><br /></Box>\n                  <Typography>\n                    {text}\n                    <IconButton size=\"small\" onClick={() => navigator.clipboard.writeText(text)}><ContentCopyIcon fontSize=\"16px\" /></IconButton>\n                  </Typography>\n                </Box>\n              </Popup>\n            }\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: [0, 0.3, 0.5, 1], translateY: [-100, 0] }}\n              transition={{ duration: 0.3, ease: 'easeOut' }}\n            >\n              <Marker\n                offsetLeft={-12}\n                offsetTop={-24}\n                draggable={true}\n                key={marker.id}\n                latitude={marker.latitude}\n                longitude={marker.longitude}\n                onDragEnd={(ev) => { handleMarkerDragEnd(marker.id, ev); }}\n                onClick={(ev) => { handleMarkerClick(marker.id, ev); }}\n              >\n                <RoomIcon color={\"info\"} />\n              </Marker>\n            </motion.div>\n          </>\n          );\n        })}\n          <Geocoder\n            mapRef={mapRef}\n            onViewportChange={handleGeocoderViewportChange}\n            mapboxApiAccessToken={MAPBOX_TOKEN}\n            position=\"top-right\"\n          />\n      </ReactMapGL>\n    </div>\n  </div>\n  );\n}\nexport default Map;","import './App.css';\nimport Map from './Map';\nimport { BrowserRouter } from \"react-router-dom\";\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <Map />\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}